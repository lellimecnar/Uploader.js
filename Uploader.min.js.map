{"version":3,"sources":["Uploader.min.js","Private.js","Uploader.js"],"names":["global","factory","define","amd","exports","module","mod","Private","this","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","keys","vals","value","val","index","indexOf","push","require","Uploader","_Private","_interopRequireDefault","obj","__esModule","default","_extend","obj1","obj2","_convertElement","elem","HTMLElement","document","querySelectorAll","Array","isArray","tmpElem","forEach","el","concat","createElement","_Private2","window","fileElement","element","DEFAULT_OPTS","allowMultiple","accept","uploadURL","fieldName","progressBar","beforeFileSelect","e","onFileSelect","files","beforeUpload","xhr","onProgress","percent","onSuccess","onError","opts","set","input","style","visibility","position","left","top","width","height","body","appendChild","setAttribute","call","addEventListener","preventDefault","click","data","FormData","append","req","XMLHttpRequest","upload","lengthComputable","Math","round","loaded","total","bar","open","setRequestHeader","send","get"],"mappings":"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","file":"Uploader.min.js","sourcesContent":[null,"let keys = [],\n\tvals = [];\n\nexport default class Private {\n\tset(key, val) {\n\t\tvar index = keys.indexOf(key);\n\n\t\tif (index <= 0) {\n\t\t\tindex = keys.push(key) - 1;\n\t\t}\n\n\t\tvals[index] = val;\n\t}\n\n\tget(key) {\n\t\treturn vals[keys.indexOf(key)];\n\t}\n}\n","import Private from './Private';\n\ndelete window.Private;\n\nlet fileElement = new Private(),\n\telement = new Private(),\n\tDEFAULT_OPTS = {\n\t\tallowMultiple: true,\n\t\taccept: null,\n\t\tuploadURL: '/',\n\t\tfieldName: 'file[]',\n\t\tprogressBar: null,\n\t\tbeforeFileSelect: (e) => {},\n\t\tonFileSelect: (e, files) => {},\n\t\tbeforeUpload: (xhr) => {},\n\t\tonProgress: (e, percent) => {},\n\t\tonSuccess: (e) => {},\n\t\tonError: (e) => {}\n\t};\n\nfunction _extend(obj1, obj2) {\n\tfor (var key in obj2) {\n\t\tobj1[key] = obj2[key];\n\t}\n\treturn obj1;\n}\n\nfunction _convertElement(elem) {\n\tif(elem instanceof HTMLElement) {\n\t\telem = [elem];\n\t} else if (typeof elem === 'string' && elem !== '') {\n\t\telem = document.querySelectorAll(elem);\n\t} else if(Array.isArray(elem)) {\n\t\tvar tmpElem = [];\n\t\telem.forEach((el) => {\n\t\t\ttmpElem.concat(_convertElement(el));\n\t\t});\n\t\telem = tmpElem;\n\t} else if (!elem) {\n\t\telem = [document.createElement('button')];\n\t}\n\n\treturn elem;\n}\n\nexport default class Uploader {\n\n\tstatic get DEFAULT_OPTS() {\n\t\treturn DEFAULT_OPTS;\n\t}\n\n\tget element() {\n\t\treturn element.get(this);\n\t}\n\n\tconstructor(elem, opts) {\n\t\telem = _convertElement(elem);\n\t\telement.set(this, elem);\n\n\t\topts = _extend(DEFAULT_OPTS, opts || {});\n\n\t\tif (opts.progressBar) {\n\t\t\topts.progressBar = _convertElement(opts.progressBar);\n\t\t}\n\n\t\tvar input = document.createElement('input');\n\t\tfileElement.set(this, input);\n\n\t\tinput.style.visibility = 'hidden';\n\t\tinput.style.position = 'fixed';\n\t\tinput.style.left = '-99999%';\n\t\tinput.style.top = input.style.left;\n\t\tinput.style.width = '1px';\n\t\tinput.style.height = input.style.width;\n\t\tdocument.body.appendChild(input);\n\n\t\tinput.setAttribute('type', 'file');\n\n\t\tif (opts.allowMultiple) {\n\t\t\tinput.setAttribute('multiple', 'multiple');\n\t\t}\n\n\t\tif (opts.accept !== null) {\n\t\t\tinput.setAttribute('accept', opts.accept);\n\t\t}\n\n\n\n\t\t[].forEach.call(elem, (el) => {\n\t\t\tel.addEventListener('click', (e) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tif (opts.beforeFileSelect(e) !== false) {\n\t\t\t\t\tinput.click();\n\t\t\t\t}\n\t\t\t})\n\t\t});\n\n\t\tinput.addEventListener('change', function(e) {\n\t\t\tvar data = new FormData();\n\n\t\t\tfor (let i in this.files) {\n\t\t\t\tdata.append(opts.fieldName, this.files[i]);\n\t\t\t}\n\n\t\t\tif (opts.onFileSelect(e, this.files, data) !== false) {\n\t\t\t\tvar req = new XMLHttpRequest();\n\n\t\t\t\treq.upload.addEventListener('progress', (e) => {\n\t\t\t\t\tvar percent = null;\n\t\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\t\tpercent = Math.round(((e.loaded * 100) / e.total) * 100) / 100;\n\t\t\t\t\t\tif (opts.progressBar) {\n\t\t\t\t\t\t\t[].forEach.call(opts.progressBar, (bar) => {\n\t\t\t\t\t\t\t\tbar.style.width = Math.round(percent)+'%';\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\topts.onProgress(e, percent);\n\t\t\t\t});\n\n\t\t\t\treq.upload.addEventListener('load', (e) => {\n\t\t\t\t\topts.onSuccess(e);\n\t\t\t\t});\n\n\t\t\t\treq.upload.addEventListener('error', (e) => {\n\t\t\t\t\topts.onError(e);\n\t\t\t\t});\n\n\t\t\t\treq.open('POST', opts.uploadURL);\n\t\t\t\treq.setRequestHeader('Cache-Control', 'no-cache');\n\n\t\t\t\tif (opts.beforeUpload(req) !== false) {\n\t\t\t\t\treq.send(data);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n"],"sourceRoot":"/source/"}